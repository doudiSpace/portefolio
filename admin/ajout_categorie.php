<?php

// **********************************************************************************************************************************
// ******************************************************* model ********************************************************************
// **********************************************************************************************************************************

require_once('initAdmin.php');

// **********************************************************************************************************************************
// ***************************************************** controleur *****************************************************************
// **********************************************************************************************************************************



// ****************** VERIFICATION + L'ENVOI DU FORMULAIRE ***************************************************

if($_SERVER['REQUEST_METHOD'] === 'POST'){
  if (isset($_POST['categorie'])) {
    //vérif des champs du formulaire
    $rules = ['categorie' => ['required' => null]];
    $form = validate_form($_POST, $rules);
    //si pas d'erreur dans la verification------------------
    if(!$form['erreur'] ){
      //si pas de doublon dans la table car clé primaire------------------
      $doubon = false;
      $tab_categorie = recuperationDb('categories');
      foreach ($tab_categorie as $c) {
        if ($c['categorie'] == $_POST['categorie']) {
          $doubon = true;
        }
      }
      if ($doubon == false) {
        //-----------------------------------------------------------------------verif ok !
        //---------------------------------------------------------- 1 - intégrer dans la base de donnée
        $categorie = htmlspecialchars($_POST['categorie']);

        ajoutDb_categorie($categorie);
        //---------------------------------------------------------- 3 - redirection
        header('location:  admin.php');
        exit;
      }
    }
  }
}

// ********************** CREATION DU FORMULAIRE *************************************************************


$formulaire = '
        <input type="text" name="categorie" placeholder="NOM"><br><br>
';

// ********************** CREATION DE LA VUE *****************************************************************
$vue = [];
$vue['titre'] = 'd\'une catégorie';
$vue['formulaire'] = $formulaire;
$vue['retour'] = 'admin.php';

// **********************************************************************************************************************************
// ******************************************************* vue **********************************************************************
// **********************************************************************************************************************************


require_once('vue/ajout.phtml');
